#!/bin/bash
set -e

if [ $# -eq 0 ]; then
    echo "Error: No *.tar.gz file provided containing docker images" >&2
    exit 1
fi

FILE="$1"
if [ ! -f "$FILE" ]; then
    echo "Error: File '$FILE' does not exist or is not a regular file" >&2
    exit 1
fi
if [[ ! "$FILE" =~ \.tar\.gz$ ]]; then
    echo "Error: File must have .tar.gz extension" >&2
    exit 1
fi
if ! gunzip -t "$FILE" 2>/dev/null; then
    echo "Error: File '$FILE' failed integrity check" >&2
    exit 1
fi
docker load -i /var/tmp/allinone.tar
